#ifndef __MEMMGR_H__
#define __MEMMGR_H__

//////////////////////////////////////////////////////////////////////////
// Operator overrides
//////////////////////////////////////////////////////////////////////////

void* operator new(size_t size);
void* operator new[] (size_t size);
void operator delete (void *p);
void operator delete[] (void *p);

//////////////////////////////////////////////////////////////////////////
// Auxiliary functions
//////////////////////////////////////////////////////////////////////////

void do_new(const char *file, const int line);
void do_delete(const char *file, const int line);
void leak_check_start();
void leak_check_end();

//////////////////////////////////////////////////////////////////////////
// Undefine all previous macros
//////////////////////////////////////////////////////////////////////////

#ifdef	new
#undef	new
#endif

#ifdef	delete
#undef	delete
#endif

//////////////////////////////////////////////////////////////////////////
// Create new macros
//////////////////////////////////////////////////////////////////////////

#define	new		(do_new (__FILE__, __LINE__), false) ? NULL : new
#define	delete	(do_delete (__FILE__, __LINE__), false) ? NULL : delete

//////////////////////////////////////////////////////////////////////////
// End
//////////////////////////////////////////////////////////////////////////

#endif
